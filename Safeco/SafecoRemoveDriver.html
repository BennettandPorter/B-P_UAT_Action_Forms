<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Safeco Web-to-Lead Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
  <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
  <style>
    .hidden { display: none; }
    .error { border-color: #ef4444; }
    .error-message {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
    .sf-date-field {
      color: #000 !important;
    }
    .sf-date-field::placeholder {
      color: #a0aec0 !important;
      opacity: 1;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 320px;
      background-color: #f9fafb;
      color: #1f2937;
      text-align: left;
      border-radius: 6px;
      padding: 10px;
      border: 1px solid #d1d5db;
      position: absolute;
      z-index: 10;
      bottom: 125%;
      left: 50%;
      margin-left: -160px;
      font-size: 0.85rem;
      line-height: 1.3;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.15);
    }
    .tooltip:hover .tooltiptext,
    .tooltip:focus-within .tooltiptext {
      visibility: visible;
    }
    #reviewBtn {
      cursor: pointer;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">
  <form
    action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8&amp;orgId=00DVD000007JpKX"
    method="POST"
    class="bg-white p-8 rounded-2xl shadow-md w-full max-w-xl space-y-6"
    id="mainForm"
    autocomplete="off"
  >
    <h2 class="text-2xl font-bold text-center text-gray-800">Safeco Remove Driver Form</h2>
    <!-- Hidden Fields -->
    <input type="hidden" name="oid" value="00DVD000007JpKX" />
  <!--  <input type="hidden" name="recordType" value="012U7000003Ie25IAC" />-->
    <input type="hidden" name="retURL" value="https://bennettandporter.com/" />
    <input type="hidden" name="first_name" value="Removedriver" />
    <input type="hidden" name="last_name" value="Lead" />
    <input type="hidden" name="status" value="New" />
    <input type="hidden" name="phone" value="2367236712" />
    <input type="hidden" name="lead_source" value="Web Form" />
    <input type="hidden" name="company" value="Caelius Test Safeco New" />
    <input type="hidden" id="00NU7000005zuNN" name="Policy_Action__c" value="Remove Driver" />
    <input type="hidden" name="delete_Action_Form__c" value="1" />
    <!--<input type="hidden" name="debug" value=1>                              
<input type="hidden" name="debugEmail" value="annie.rawal@caeliusconsulting.com">-->
    <input type="hidden" id="formDataJson" name="Form_Captured_Data__c" value="" />
    <input type="hidden" id="formMissingData" name="Form_Missing_Data__c" value="" />
                            <input type="hidden" name="Carrier__c" value ="Safeco">




    <!-- Policy Changes Section -->
    <section class="bg-gray-50 border rounded-xl p-6 shadow-inner" aria-label="Policy Changes Section">
      <h3 class="text-xl font-semibold mb-4 text-gray-700">Policy Changes</h3>
      <div class="mb-4">
        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
        <input
          type="email" id="email" name="email"
          class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
          autocomplete="off"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select the Request Type:</label>
        <div class="flex space-x-4 mb-2">
          <label class="inline-flex items-center ">
            <input type="radio" name="Is_this_a_quote_or_a_change_request__c" value="Quote" class="mr-2 " />Quote
          </label>
          <label class="inline-flex items-center">
            <input type="radio" name="Is_this_a_quote_or_a_change_request__c" value="Endorse" class="mr-2" />Endorsement
          </label>
        </div>
        <div id="quotePolicyError" class="error-message hidden">Please select an option</div>
      </div>
      <div class="space-y-4 mt-2">
        <div>
          <label for="00NU7000005zuX3" class="block text-sm font-medium text-gray-700">Policy Number</label>
          <input
            type="text"
            id="00NU7000005zuX3"
            name="Policy_Number__c"
            pattern="Y\d{7}"
          
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
            title="Policy Number must start with 'Y' and be 8 characters total (e.g., Y1234567)"
          />
          <div id="policyNumberError" class="error-message hidden">Policy Number must start with 'Y' and be 8 digits total (e.g., Y1234567).</div>
        </div>
        <div>
          <label for="00NU7000005zuLl" class="block text-sm font-medium text-gray-700">Effective Date</label>
          <input 
            type="text" 
            id="00NU7000005zuLl" 
            name="Date__c"
            placeholder="MM/DD/YYYY"
            autocomplete="off"
            class="mt-1 w-full p-2 border border-gray-700 rounded-lg shadow-sm sf-date-field" />
          <div id="00NU7000005zuLl_error" class="error-message hidden">Enter a valid MM/DD/YYYY date.</div>
        </div>
      </div>
    </section>

    <!-- Driver Details Section -->
    <section class="bg-gray-50 border rounded-xl p-6 shadow-inner" aria-label="Driver Details Section">
      <h3 class="text-xl font-semibold mb-4 text-gray-700">Driver Details</h3>
      <div class="mb-4">
        <label for="00NU7000006j9bZ" class="block text-sm font-medium text-gray-700">Reason for Deleting Driver</label>
        <select id="00NU7000006j9bZ" name="Reaon_for_Deleting_Driver__c" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm">
          <option value="">--None--</option>
          <option value="No longer resides at this address">No longer resides at this address</option>
          <option value="Deceased">Deceased</option>
          <option value="Incarcerated">Incarcerated</option>
        </select>
      </div>
      <div id="driverDetailsSection" class="space-y-4 mb-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="00NU7000005zuOz" class="block text-sm font-medium text-gray-700">First Name</label>
            <input type="text" id="00NU7000005zuOz" name="First_Name__c" class="w-full p-2 border border-gray-300 rounded-lg" />
          </div>
          <div>
            <label for="birthYear" class="block text-sm font-medium text-gray-700">Birth Year</label>
            <select id="00NU7000006lumT" name="BirthYear__c" class="w-full p-2 border border-gray-300 rounded-lg">
              <option value="">--Select Year--</option>
            </select>
            <div id="birthYearError" class="error-message hidden">Please select a birth year.</div>
          </div>
        </div>
      </div>
      <div>
        <label for="00NU7000005zuVR" class="block text-sm font-medium text-gray-700">Relationship to Insured</label>
        <select id="00NU7000005zuVR" name="Relationship_to_Insured__c" class="w-full p-2 border border-gray-300 rounded-lg mb-4">
          <option value="">--Select--</option>
          <option value="Spouse">Spouse</option>
          <option value="Domestic Partner">Domestic Partner</option>
          <option value="Child">Child</option>
          <option value="Parent">Parent</option>
          <option value="Other Relative">Other Relative</option>
          <option value="Roommate">Roommate</option>
        </select>
      </div>
      <div id="maritalStatusContainer" class="hidden w-full mb-4">
        <label for="00NU7000006kjDB" class="block text-sm font-medium text-gray-700">What will be the marital status of insured driver?</label>
        <select id="00NU7000006kjDB" name="Marital_Status_RD__c" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm">
          <option value="">--None--</option>
          <option value="Divorced">Divorced</option>
          <option value="Separated">Separated</option>
          <option value="Widowed">Widowed</option>
        </select>
      </div>
    </section>

    <!-- Vehicle Information Section -->
    <section class="bg-gray-50 border rounded-xl p-6 shadow-inner" aria-label="Vehicle Information Section">
      <h3 class="text-xl font-semibold mb-4 text-gray-700">Vehicle Information</h3>
      <div class="space-y-4">
        <div>
          <label for="00NU7000006N0iD" class="block text-sm font-medium text-gray-700">Vehicle Use</label>
          <select id="00NU7000006N0iD" name="Vehicle_Use__c"
                  class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm">
            <option value="">--None--</option>
            <option value="Pleasure or Work/School < 4 miles">Pleasure or Work/School &lt; 4 miles</option>
            <option value="Work/School 4 or more miles">Work/School 4 or more miles</option>
          </select>
        </div>

        <div id="vehicleCommuteFields" class="hidden space-y-4">
          <div>
            <label for="00NU7000006kjI1" class="block text-sm font-medium text-gray-700">Mileage One Way</label>
            <input type="text" id="00NU7000006kjI1" name="Mileage_One_Way__c" class="w-full p-2 border border-gray-300 rounded-lg" />
          </div>
        </div>

        <div>
          <label for="00NU7000006N0zx" class="block text-sm font-medium text-gray-700">Annual Miles</label>
          <input type="text" id="00NU7000006N0zx" name="Annual_Miles__c" class="w-full p-2 border border-gray-300 rounded-lg" />
        </div>

        <div>
          <label for="00NU7000006N0wj" class="block text-sm font-medium text-gray-700">Ownership</label>
          <select id="00NU7000006N0wj" name="Ownership__c"
                  class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm">
            <option value="">--None--</option>
            <option value="Owned">Owned</option>
            <option value="Financed">Financed</option>
            <option value="Leased">Leased</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Submit Button -->
    <button
      type="button"
      id="reviewBtn"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg shadow"
    >
               Review and Submit

    </button>

  </form>

  <!-- Confirmation Dialog -->
  <div
    id="dialog"
    class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50"
    role="dialog"
    aria-modal="true"
    aria-labelledby="dialogTitle"
  >
    <div
      class="bg-white rounded-lg p-6 max-w-md w-full shadow-lg text-gray-800"
    >
      <h3 id="dialogTitle" class="text-lg font-semibold mb-4"></h3>
      <ul id="missingFieldsList" class="mb-4 text-red-600 text-sm"></ul>
      <div class="flex justify-end space-x-3" id="dialogButtons">
        <button
          id="proceedBtn"
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-medium"
        >
          Proceed to End Request
        </button>
        <button
          id="editBtn"
          class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 font-medium"
        >
          Edit
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("mainForm");
      const dialog = document.getElementById("dialog");
      const dialogTitle = document.getElementById("dialogTitle");
      const missingFieldsList = document.getElementById("missingFieldsList");
      const proceedBtn = document.getElementById("proceedBtn");
      const editBtn = document.getElementById("editBtn");
      const formDataJsonInput = document.getElementById("formDataJson");
      const reviewBtn = document.getElementById("reviewBtn");

      // Pikaday datepicker setup
      function parseMMDDYYYY(s) {
        if (!/^(\d{2})\/(\d{2})\/(\d{4})$/.test(s)) return null;
        const [m, d, y] = s.split('/').map(Number);
        if (m < 1 || m > 12 || d < 1 || d > 31) return null;
        const date = new Date(y, m - 1, d);
        if (date.getMonth() !== m - 1 || date.getDate() !== d || date.getFullYear() !== y) return null;
        return date;
      }
      document.querySelectorAll('.sf-date-field').forEach(function(field) {
        new Pikaday({
          field: field,
          format: 'MM/DD/YYYY',
          onSelect: function(date) {
            if (date) {
              field.value = ("0" + (date.getMonth() + 1)).slice(-2) + "/" +
                            ("0" + date.getDate()).slice(-2) + "/" + date.getFullYear();
              showDateError(field, false);
            }
          }
        });
        field.addEventListener('input', function() {
          const valid = !field.value || parseMMDDYYYY(field.value);
          showDateError(field, !valid);
          field.setCustomValidity(valid ? "" : "Invalid date format (MM/DD/YYYY)");
        });
        field.addEventListener('blur', function() {
          const valid = !field.value || parseMMDDYYYY(field.value);
          showDateError(field, !valid);
          field.setCustomValidity(valid ? "" : "Invalid date format (MM/DD/YYYY)");
        });
      });
      function showDateError(field, show) {
        const errorDiv = document.getElementById(field.id + "_error");
        if(errorDiv) errorDiv.classList.toggle("hidden", !show);
        field.classList.toggle("error", show);
      }

      // Policy Number validation
      const policyNumberInput = document.getElementById("00NU7000005zuX3");
      const policyNumberError = document.getElementById("policyNumberError");
    // function validatePolicyNumberField() {
      //  const val = policyNumberInput.value.trim();
    //    const valid = /^Y\d{7}$/.test(val);
    //    policyNumberInput.classList.toggle("error", !valid && val.length > 0);
      //  policyNumberError.classList.toggle("hidden", valid || val.length === 0);
        //policyNumberInput.setCustomValidity(valid || val.length === 0 ? "" : "Policy Number must start with 'Y' and be 8 characters (e.g., Y1234567)");
      //}
     // policyNumberInput.addEventListener("input", validatePolicyNumberField);
      //policyNumberInput.addEventListener("blur", validatePolicyNumberField);
     // validatePolicyNumberField();

      // Vehicle Use conditional logic
      const vehicleUse = document.getElementById("00NU7000006N0iD");
      const commuteFields = document.getElementById("vehicleCommuteFields");
      const mileageOneWay = document.getElementById("00NU7000006kjI1");

      function toggleCommuteFields() {
        if (vehicleUse.value === "Work/School 4 or more miles") {
          commuteFields.classList.remove("hidden");
          mileageOneWay.required = true;
        } else {
          commuteFields.classList.add("hidden");
          mileageOneWay.required = false;
          mileageOneWay.value = "";
        }
      }
      vehicleUse.addEventListener("change", toggleCommuteFields);
      toggleCommuteFields();

      // Relationship and Marital Status logic
      const relationshipToInsured = document.getElementById("00NU7000005zuVR");
      const maritalStatusContainer = document.getElementById("maritalStatusContainer");
      const maritalStatusField = document.getElementById("00NU7000006kjDB");

      function toggleMaritalStatusField() {
        if (relationshipToInsured.value === "Spouse") {
          maritalStatusContainer.classList.remove("hidden");
          maritalStatusField.required = true;
        } else {
          maritalStatusContainer.classList.add("hidden");
          maritalStatusField.required = false;
          maritalStatusField.value = "";
        }
      }
      relationshipToInsured.addEventListener("change", toggleMaritalStatusField);
      toggleMaritalStatusField();

      // Birth Year dropdown population and validation
      const birthYearSelect = document.getElementById("00NU7000006lumT");
      if (birthYearSelect) {
        const currentYear = new Date().getFullYear();
        for (let y = currentYear; y >= 1900; y--) {
          const opt = document.createElement("option");
          opt.value = String(y);
          opt.text = String(y);
          birthYearSelect.appendChild(opt);
        }

        birthYearSelect.addEventListener("change", function() {
          const valid = birthYearSelect.value !== "";
          birthYearSelect.classList.toggle("error", !valid);
          document.getElementById("birthYearError").classList.toggle("hidden", valid);
          birthYearSelect.setCustomValidity(valid ? "" : "Please select a birth year");
        });
      }

      // Salesforce radio hidden checkbox handling
      document.querySelectorAll('input[name="Is_this_a_quote_or_a_change_request__c"]').forEach(radio => {
        radio.addEventListener('change', function() {
          document.getElementById("sfQuote").value = this.value === "Quote" ? "true" : "false";
          document.getElementById("sfEndorsement").value = this.value === "Endorse" ? "true" : "false";
        });
      });

      // Validation and modal on Review button click
      reviewBtn.addEventListener("click", function(e) {
       e.preventDefault();

    const missing = [];
    const missingData = [];
    const completedData = [];

    function validate(id, label, options) {
      const input = document.getElementById(id);
      if (!input || input.disabled) return;
      const val = input.value.trim();

      let isMissing = !val;
      if (!isMissing && options) {
        if (options.pattern && !options.pattern.test(val)) isMissing = true;
        if (options.custom && !options.custom(val)) isMissing = true;
      }

      if (isMissing) {
        missing.push(label);
        missingData.push({ field: label, value: val || "" });
      } else {
        completedData.push({ field: label, value: val });
      }
    }


        // Validate fields with your specific rules:
        validate("email", "Email", {pattern: /^.+@.+\..+$/});
        const reqType = Array.from(document.querySelectorAll('input[name="Is_this_a_quote_or_a_change_request__c"]')).find(i => i.checked);
        if (!reqType) {
          missing.push("Request Type");
          missingData.push({field: "Request Type", value: ""});
        } else {
          completedData.push({field: "Request Type", value: reqType.value});
        }
        validate("00NU7000005zuX3", "Policy Number");
        
        validate("00NU7000005zuLl", "Effective Date", {pattern: /^(0[1-9]|1[0-2])\/([0-2][0-9]|3[01])\/\d{4}$/});
        validate("00NU7000006j9bZ", "Reason for Deleting Driver");

        validate("00NU7000005zuOz", "First Name");
        validate("00NU7000006lumT", "Birth Year");
        validate("00NU7000005zuVR", "Relationship to Insured");
        if (!maritalStatusContainer.classList.contains("hidden")) {
          validate("00NU7000006kjDB", "Marital Status");
        }
        validate("00NU7000006N0iD", "Vehicle Use");
        if (!commuteFields.classList.contains("hidden")) {
          validate("00NU7000006kjI1", "Mileage One Way");
        }
        validate("00NU7000006N0zx", "Annual Miles");
        validate("00NU7000006N0wj", "Ownership");

        const capturedStr = completedData
  .map(d => `${d.field} = ${d.value}`)
  .join("\n");

const missingStr = missingData
  .map(d => d.field)
  .join("\n");

// Set hidden fields
formDataJsonInput.value = capturedStr;

const formMissingHidden = document.getElementById("formMissingData");
if (formMissingHidden) {
  formMissingHidden.value = missingStr;
}

        if (missing.length) {
          dialogTitle.textContent = " Below Mandatory Fields are missing and the Team will contact you shortly.";
          missingFieldsList.innerHTML = missing.map(f => `<li>${f}</li>`).join("");
        } else {
          dialogTitle.textContent = "All mandatory fields are completed. Ready to submit your request?";
          missingFieldsList.innerHTML = "";
        }
        dialog.classList.remove("hidden");
        proceedBtn.classList.remove("hidden");
      });

      editBtn.addEventListener("click", () => {
        dialog.classList.add("hidden");
      });

      proceedBtn.addEventListener("click", () => {
        dialog.classList.add("hidden");
        form.submit();
      });

      window.addEventListener("click", e => {
        if (e.target === dialog) {
          dialog.classList.add("hidden");
        }
      });
      window.addEventListener("keydown", e => {
        if (e.key === "Escape" && !dialog.classList.contains("hidden")) {
          dialog.classList.add("hidden");
        }
      });
    });
  </script>

  <!-- Modal Dialog HTML -->
  <div
    id="dialog"
    class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50"
    role="dialog"
    aria-modal="true"
    aria-labelledby="dialogTitle"
  >
    <div
      class="bg-white rounded-lg p-6 max-w-md w-full shadow-lg text-gray-800"
    >
      <h3 id="dialogTitle" class="text-lg font-semibold mb-4"></h3>
      <ul id="missingFieldsList" class="mb-4 text-red-600 text-sm"></ul>
      <div class="flex justify-end space-x-3" id="dialogButtons">
        <button
          id="proceedBtn"
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-medium"
        >
          Proceed to End Request
        </button>
        <button
          id="editBtn"
          class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 font-medium"
        >
          Edit
        </button>
      </div>
    </div>
  </div>

</body>
</html>