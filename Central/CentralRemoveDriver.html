<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Central Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css" />
    <style>
      .hidden { display: none; }
      .star { color: #ef4444; margin-left: 2px; }
      .modal-bg { background: rgba(0, 0, 0, 0.4); }
      .error-message { color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem; }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">
    <form
      id="mainForm"
      action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8&orgId=00DVD000007JpKX"
      method="POST"
      class="bg-white p-8 rounded-2xl shadow-md w-full max-w-xl space-y-8 relative"
      autocomplete="off"
      novalidate
    >
      <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">
        Remove Driver Central Insurance Form
      </h2>

      <div class="bg-gray-50 border rounded-xl p-6 shadow-inner">
        <h3 class="text-xl font-semibold mb-4 text-gray-700">Policy Changes</h3>

        <div class="mb-3">
          <label for="email" class="block text-sm font-medium text-gray-700">
            Email<span class="star">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
          />
        </div>

        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-2">Select the Request Type:<span class="star">*</span></label>
          <div class="flex space-x-4 mb-2">
            <label class="inline-flex items-center">
              <input type="radio" name="Is_this_a_quote_or_a_change_request__c" value="Quote" class="mr-2" />Quote
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="Is_this_a_quote_or_a_change_request__c" value="Endorse" class="mr-2" />Endorsement
            </label>
          </div>
        </div>

        <input type="hidden" id="00NU7000005zuNN" name="Policy_Action__c" value="Remove Driver" />

        <div class="mb-3">
          <label for="00NU7000005zuX3" class="block text-sm font-medium text-gray-700">
            Policy Number<span class="star">*</span>
          </label>
          <input
            type="text"
            id="00NU7000005zuX3"
            name="Policy_Number__c"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          />
        </div>

        <div class="mb-3">
          <label for="00NU7000005zuLl" class="block text-sm font-medium text-gray-700">
            Effective Date (MM/DD/YYYY)<span class="star">*</span>
          </label>
          <input
            type="text"
            id="00NU7000005zuLl"
            name="Date__c"
            placeholder="MM/DD/YYYY"
            maxlength="10"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"
          />
        </div>
      </div>

      <div class="bg-gray-50 border rounded-xl p-6 shadow-inner mt-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-700">Driver Details</h3>
        
        <div class="mb-3">
          <label for="driverName" class="block text-sm font-medium text-gray-700">
            Driver Name<span class="star">*</span>
          </label>
          <input
            type="text"
            id="driverName"
            name="First_Name__c"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          />
        </div>

        <div class="mb-3">
          <label for="reasonToDelete" class="block text-sm font-medium text-gray-700">
            Reason to delete driver<span class="star">*</span>
          </label>
          <select id="reasonToDelete" name="reasonToDelete__c" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm">
            <option value="">Select Reason</option>
            <option value="Still in household, but re-written with another company">Still in household, but re-written with another company</option>
            <option value="Deceased">Deceased</option>
            <option value="Divorced">Divorced</option>
            <option value="Moved out of household">Moved out of household</option>
            <option value="Re-written on another company">Re-written on another company</option>
            <option value="No longer licensed">No longer licensed</option>
            <option value="Active military duty">Active military duty</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="mb-3 hidden" id="additionalRemarksDiv">
          <label for="additionalRemarks" class="block text-sm font-medium text-gray-700">
            Additional Remarks<span class="star">*</span>
          </label>
          <input
            type="text"
            id="additionalRemarks"
            name="additionalRemarks__c"
            class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm"
          />
        </div>
      </div>

      <input type="hidden" name="oid" value="00DVD000007JpKX" />
      <input type="hidden" name="retURL" value="https://bennettandporter.com/" />
      <input type="hidden" name="first_name" value="Central Remove Driver" />
      <input type="hidden" name="last_name" value=" Demo Check" />
      <input type="hidden" name="status" value="New" />
      <input type="hidden" name="phone" value="28436836129" />
      <input type="hidden" name="lead_source" value="Web Form" />
      <input type="hidden" name="delete_Action_Form__c" value="1" />
      <input type="hidden" id="formDataJson" name="Form_Captured_Data__c" value="" />
      <input type="hidden" id="formMissingData" name="Form_Missing_Data__c" value="" />
      <input type="hidden" name="Carrier__c" value="Central Insurance">
      <input type="hidden" name="company" value="Caelius Test Central Remove Driver" />
      <input type="hidden" name="Debug_Notes__c" value="Central Test: 2025-06-27 07:21AM" />

      <div class="flex justify-end mt-6">
        <button type="button" id="reviewBtn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl hover:bg-blue-700 transition">
          Review and Submit
        </button>
      </div>
    </form>

    <div id="dialog" class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50" role="dialog" aria-modal="true">
      <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-lg text-gray-800">
        <h3 id="dialogTitle" class="text-lg font-semibold mb-4"></h3>
        <ul id="missingFieldsList" class="mb-4 text-red-600 text-sm list-disc pl-5"></ul>
        <div class="flex justify-end space-x-3">
          <button id="proceedBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-medium">Proceed to End Request</button>
          <button id="editBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 font-medium">Edit</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const reasonToDelete = document.getElementById("reasonToDelete");
        const additionalRemarksDiv = document.getElementById("additionalRemarksDiv");
        const additionalRemarks = document.getElementById("additionalRemarks");
        const form = document.getElementById("mainForm");
        const reviewBtn = document.getElementById("reviewBtn");
        const dialog = document.getElementById("dialog");
        const dialogTitle = document.getElementById("dialogTitle");
        const missingFieldsList = document.getElementById("missingFieldsList");
        const proceedBtn = document.getElementById("proceedBtn");
        const editBtn = document.getElementById("editBtn");

        new Pikaday({
          field: document.getElementById("00NU7000005zuLl"),
          format: "MM/DD/YYYY",
          toString(date) {
            const day = String(date.getDate()).padStart(2, "0");
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const year = date.getFullYear();
            return `${month}/${day}/${year}`;
          }
        });

        const fieldData = [
          { id: "email", label: "Email", type: "email" },
          { id: "00NU7000005zuX3", label: "Policy Number" },
          { id: "00NU7000005zuLl", label: "Effective Date (MM/DD/YYYY)", type: "date" },
          { id: "driverName", label: "Driver Name" },
          { id: "reasonToDelete", label: "Reason to delete driver" },
          { id: "additionalRemarks", label: "Additional Remarks" },
          // Match ID to the HTML 'name' attribute for radio processing
          { id: "Is_this_a_quote_or_a_change_request__c", label: "Request Type", type: "radio" }
        ];

        function getSelectedRadioValue(name) {
          const selected = document.querySelector(`input[name="${name}"]:checked`);
          return selected ? selected.value : null;
        }

        reasonToDelete.addEventListener("change", function () {
          const showRemarks = ["Still in household, but re-written with another company", "Other"].includes(this.value);
          if (showRemarks) {
            additionalRemarksDiv.classList.remove("hidden");
            additionalRemarks.setAttribute("required", "required");
          } else {
            additionalRemarksDiv.classList.add("hidden");
            additionalRemarks.removeAttribute("required");
            additionalRemarks.value = "";
          }
        });

        reviewBtn.addEventListener("click", () => {
          const missingData = [];
          const completedData = [];

          fieldData.forEach(field => {
            let val = "";
            let isMissing = false;

            if (field.type === "radio") {
              // Retrieve value using the 'name' stored in 'field.id'
              val = getSelectedRadioValue(field.id);
              isMissing = !val;
            } else {
              const el = document.getElementById(field.id);
              if (!el) return;
              
              val = el.value.trim();
              const isHidden = (field.id === "additionalRemarks" && additionalRemarksDiv.classList.contains("hidden"));
              
              if (!val && !isHidden) {
                isMissing = true;
              } else if (val && field.type === "email" && !el.checkValidity()) {
                isMissing = true;
              }
            }

            if (isMissing) {
              missingData.push(field.label);
            } else if (val) {
              completedData.push(`${field.label} = ${val}`);
            }
          });

          // Write captured and missing data to hidden fields
          document.getElementById("formDataJson").value = completedData.join("\n");
          document.getElementById("formMissingData").value = missingData.join("\n");

          // Update Dialog UI
          if (missingData.length > 0) {
            dialogTitle.textContent = "Mandatory Fields Missing:";
            missingFieldsList.innerHTML = missingData.map(f => `<li>${f}</li>`).join("");
          } else {
            dialogTitle.textContent = "Ready to submit your request?";
            missingFieldsList.innerHTML = "";
          }
          dialog.classList.remove("hidden");
        });

        editBtn.addEventListener("click", () => dialog.classList.add("hidden"));
        proceedBtn.addEventListener("click", () => form.submit());
      });
    </script>
  </body>
</html>
